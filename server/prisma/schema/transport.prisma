model Student {
    id            String   @id @default(uuid()) @db.Uuid
    name          String
    rollNo        String   @unique @map("roll_no")
    grade         String
    contactNumber String?  @map("contact_number")
    address       String?
    createdAt     DateTime @default(now()) @map("created_at")
    updatedAt     DateTime @updatedAt @map("updated_at")

    feeAssignments      StudentFeeAssignment[]
    transportAllocation TransportAllocation?

    @@map("students")
    @@schema("trust_innovation_db")
}

model StudentFeeAssignment {
    id             String   @id @default(uuid()) @db.Uuid
    studentId      String   @map("student_id") @db.Uuid
    student        Student  @relation(fields: [studentId], references: [id])
    feeDescription String   @map("fee_description")
    amount         Decimal  @db.Decimal(10, 2)
    month          String
    status         String   @default("PENDING") // PENDING, PAID
    createdAt      DateTime @default(now()) @map("created_at")
    updatedAt      DateTime @updatedAt @map("updated_at")

    @@map("student_fee_assignments")
    @@schema("trust_innovation_db")
}

model TransportFeeMaster {
    id        String   @id @default(uuid()) @db.Uuid
    name      String
    amount    Decimal  @db.Decimal(10, 2)
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    routes Route[]

    @@map("transport_fee_masters")
    @@schema("trust_innovation_db")
}

model Vehicle {
    id            String   @id @default(uuid()) @db.Uuid
    vehicleNumber String   @unique @map("vehicle_number")
    driverName    String   @map("driver_name")
    helperName    String?  @map("helper_name")
    contactNumber String   @map("contact_number")
    capacity      Int?
    createdAt     DateTime @default(now()) @map("created_at")
    updatedAt     DateTime @updatedAt @map("updated_at")

    allocations      TransportAllocation[]
    routeAssignments VehicleRouteAssignment[]

    @@map("vehicles")
    @@schema("trust_innovation_db")
}

model PickupPoint {
    id        String   @id @default(uuid()) @db.Uuid
    name      String
    address   String
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    routeStops  RoutePickupPoint[]
    allocations TransportAllocation[]

    @@map("pickup_points")
    @@schema("trust_innovation_db")
}

model Route {
    id             String   @id @default(uuid()) @db.Uuid
    name           String
    startPoint     String   @map("start_point")
    endPoint       String   @map("end_point")
    transportFeeId String?  @map("transport_fee_id") @db.Uuid
    createdAt      DateTime @default(now()) @map("created_at")
    updatedAt      DateTime @updatedAt @map("updated_at")

    transportFee       TransportFeeMaster?      @relation(fields: [transportFeeId], references: [id])
    stops              RoutePickupPoint[]
    vehicleAssignments VehicleRouteAssignment[]
    allocations        TransportAllocation[]

    @@map("routes")
    @@schema("trust_innovation_db")
}

model RoutePickupPoint {
    id            String   @id @default(uuid()) @db.Uuid
    routeId       String   @map("route_id") @db.Uuid
    pickupPointId String   @map("pickup_point_id") @db.Uuid
    sequenceOrder Int      @map("sequence_order")
    createdAt     DateTime @default(now()) @map("created_at")
    updatedAt     DateTime @updatedAt @map("updated_at")

    route       Route       @relation(fields: [routeId], references: [id])
    pickupPoint PickupPoint @relation(fields: [pickupPointId], references: [id])

    @@map("route_pickup_points")
    @@schema("trust_innovation_db")
}

model VehicleRouteAssignment {
    id        String   @id @default(uuid()) @db.Uuid
    vehicleId String   @map("vehicle_id") @db.Uuid
    routeId   String   @map("route_id") @db.Uuid
    isActive  Boolean  @default(true) @map("is_active")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    vehicle Vehicle @relation(fields: [vehicleId], references: [id])
    route   Route   @relation(fields: [routeId], references: [id])

    @@map("vehicle_route_assignments")
    @@schema("trust_innovation_db")
}

model TransportAllocation {
    id            String   @id @default(uuid()) @db.Uuid
    studentId     String   @unique @map("student_id") @db.Uuid
    routeId       String   @map("route_id") @db.Uuid
    vehicleId     String   @map("vehicle_id") @db.Uuid
    pickupPointId String?  @map("pickup_point_id") @db.Uuid
    startDate     DateTime @default(now()) @map("start_date")
    status        String   @default("ACTIVE")
    createdAt     DateTime @default(now()) @map("created_at")
    updatedAt     DateTime @updatedAt @map("updated_at")

    student     Student      @relation(fields: [studentId], references: [id])
    route       Route        @relation(fields: [routeId], references: [id])
    vehicle     Vehicle      @relation(fields: [vehicleId], references: [id])
    pickupPoint PickupPoint? @relation(fields: [pickupPointId], references: [id])

    @@map("transport_allocations")
    @@schema("trust_innovation_db")
}
